
# M0Club environment config: prod
# Production config must use KMS/HSM for all key material and strict network boundaries.

[env]
name = "prod"
region = "ap-southeast-1"
log_level = "warn"

[solana]
cluster = "mainnet-beta"
rpc_url = "https://solana-mainnet-rpc.example.com"
ws_url  = "wss://solana-mainnet-ws.example.com"
commitment = "finalized"
timeout_ms = 25000
max_retries = 10

[programs]
registry_program_id = "M0Reg1stry11111111111111111111111111111111"
oracle_program_id   = "M0Orac1e111111111111111111111111111111111"
vault_program_id    = "M0Vaul7t111111111111111111111111111111111"

[accounts]
fee_payer_key_ref  = "kms://prod/solana/fee-payer"
submitter_key_ref  = "kms://prod/solana/submitter"
# Optional: guardian/admin controls should be multisig, not single keys.
registry_admin_ref = "multisig://prod/registry-admin"
pause_guardian_ref = "multisig://prod/pause-guardian"

[storage]
postgres_url = "postgres://m0_prod:CHANGE_ME@prod-postgres:5432/m0_prod?sslmode=require"
redis_url    = "redis://:CHANGE_ME@prod-redis:6379/0"
clickhouse_url = "http://prod-clickhouse:8123"
object_store = "s3"
object_store_bucket = "m0club-prod-artifacts"
object_store_prefix = "m0/prod"

[eventlog]
driver = "kafka"
brokers = ["prod-kafka-0:9092", "prod-kafka-1:9092", "prod-kafka-2:9092"]
topic_prefix = "m0.prod"
consumer_group = "m0-prod"
max_inflight = 20000

[engine]
profile = "prod"
tick_interval_ms = 200
max_concurrent_markets = 512
max_inflight_events = 2000000
feature_window_seconds = 7200
bundle_max_markets = 64

[engine.connectors]
onchain_enabled   = true
sports_enabled    = true
politics_enabled  = true
macro_enabled     = true
crypto_enabled    = true

[engine.normalization]
strict_schema = true
drop_unknown_fields = true
default_timezone = "UTC"
max_clock_skew_ms = 15000

[engine.models]
model_family = "bayes_v1"
calibration_enabled = true
calibration_artifact_path = "artifacts/calibration/prod/calibration.json"
prior_strength = 3.0
min_observations = 24
max_features = 1024

[engine.guardrails]
policy_level = "STRICT"
max_jump_bps = 700
max_ci_width_bps = 5500
min_source_coverage_ratio = 0.85
max_staleness_ms = 60000
block_on_divergence = true
block_on_ci_invalid = true

[publish]
enabled = true
mode = "commit_reveal"
commit_reveal = true
cadence_ms = 500
concurrency = 4
compute_unit_limit = 1400000
priority_fee_micro_lamports = 5000
reveal_delay_ms = 1000
max_reveal_retries = 30
idempotency_store = "postgres"

[signers]
active_signer_set_id = 100
threshold = 5
key_source = "kms"
signer_agent_endpoints = [
  "http://m0-signer-agent-0.m0-prod.svc.cluster.local:9100",
  "http://m0-signer-agent-1.m0-prod.svc.cluster.local:9100",
  "http://m0-signer-agent-2.m0-prod.svc.cluster.local:9100",
  "http://m0-signer-agent-3.m0-prod.svc.cluster.local:9100",
  "http://m0-signer-agent-4.m0-prod.svc.cluster.local:9100",
  "http://m0-signer-agent-5.m0-prod.svc.cluster.local:9100",
  "http://m0-signer-agent-6.m0-prod.svc.cluster.local:9100",
]
request_timeout_ms = 1500

[api]
http_bind = "0.0.0.0:8080"
ws_bind   = "0.0.0.0:8090"
cors_allowed_origins = ["https://m0club.com", "https://app.m0club.com"]
max_request_body_bytes = 5242880
rate_limit_rps = 200
rate_limit_burst = 1000

[security]
require_tls = true
mTLS_enabled = true
jwt_enabled = true
admin_api_enabled = false
# Token refs must be provided via secret managers, never inline.
admin_token_ref = "kms://prod/app/admin-token"

[paths]
markets_config_dir = "config/markets"
risk_config_dir    = "config/risk"
telemetry_dir      = "config/telemetry"
