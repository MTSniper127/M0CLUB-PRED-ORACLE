
# M0Club environment config: staging
# Staging should mirror production topology while using separate keys and endpoints.

[env]
name = "staging"
region = "ap-southeast-1"
log_level = "info"

[solana]
cluster = "devnet"
rpc_url = "https://api.devnet.solana.com"
ws_url  = "wss://api.devnet.solana.com/"
commitment = "confirmed"
timeout_ms = 20000
max_retries = 8

[programs]
registry_program_id = "M0Reg1stry11111111111111111111111111111111"
oracle_program_id   = "M0Orac1e111111111111111111111111111111111"
vault_program_id    = "M0Vaul7t111111111111111111111111111111111"

[accounts]
fee_payer_key_ref  = "kms://staging/solana/fee-payer"
submitter_key_ref  = "kms://staging/solana/submitter"

[storage]
postgres_url = "postgres://m0_staging:CHANGE_ME@staging-postgres:5432/m0_staging"
redis_url    = "redis://:CHANGE_ME@staging-redis:6379/0"
clickhouse_url = "http://staging-clickhouse:8123"
object_store = "s3"
object_store_bucket = "m0club-staging-artifacts"
object_store_prefix = "m0/staging"

[eventlog]
driver = "kafka"
brokers = ["staging-kafka:9092"]
topic_prefix = "m0.staging"
consumer_group = "m0-staging"
max_inflight = 8192

[engine]
profile = "staging"
tick_interval_ms = 250
max_concurrent_markets = 128
max_inflight_events = 500000
feature_window_seconds = 3600
bundle_max_markets = 48

[engine.connectors]
onchain_enabled   = true
sports_enabled    = true
politics_enabled  = true
macro_enabled     = true
crypto_enabled    = true

[engine.normalization]
strict_schema = true
drop_unknown_fields = true
default_timezone = "UTC"
max_clock_skew_ms = 20000

[engine.models]
model_family = "bayes_v1"
calibration_enabled = true
calibration_artifact_path = "artifacts/calibration/staging/calibration.json"
prior_strength = 2.0
min_observations = 16
max_features = 512

[engine.guardrails]
policy_level = "STRICT"
max_jump_bps = 900
max_ci_width_bps = 6000
min_source_coverage_ratio = 0.75
max_staleness_ms = 90000
block_on_divergence = true
block_on_ci_invalid = true

[publish]
enabled = true
mode = "commit_reveal"
commit_reveal = true
cadence_ms = 800
concurrency = 3
compute_unit_limit = 1400000
priority_fee_micro_lamports = 2500
reveal_delay_ms = 900
max_reveal_retries = 20
idempotency_store = "postgres"

[signers]
active_signer_set_id = 10
threshold = 3
key_source = "kms"
signer_agent_endpoints = [
  "http://m0-signer-agent-0.m0-staging.svc.cluster.local:9100",
  "http://m0-signer-agent-1.m0-staging.svc.cluster.local:9100",
  "http://m0-signer-agent-2.m0-staging.svc.cluster.local:9100",
]
request_timeout_ms = 2000

[api]
http_bind = "0.0.0.0:8080"
ws_bind   = "0.0.0.0:8090"
cors_allowed_origins = ["https://staging.m0club.com"]
max_request_body_bytes = 5242880
rate_limit_rps = 100
rate_limit_burst = 400

[security]
require_tls = true
mTLS_enabled = true
jwt_enabled = true
admin_api_enabled = true
admin_token_ref = "kms://staging/app/admin-token"

[paths]
markets_config_dir = "config/markets"
risk_config_dir    = "config/risk"
telemetry_dir      = "config/telemetry"
